<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <title>exploit.design</title>

        <script src="assets/js/jquery-3.5.1.min.js"></script>
        <script src="assets/js/jquery.terminal-2.17.6.min.js"></script>
        <script src="assets/js/keyboard.js"></script>
        <script src="assets/js/less.js"></script>
        <script src="assets/js/css-vars-ponyfill.min.js"></script>
        <script src="assets/js/wcwidth.js"></script>

        <link rel="stylesheet" href="assets/css/jquery.terminal-2.17.6.min.css" />
        <link rel="stylesheet" href="assets/css/style.css" />

    	<!--[if IE]>
    	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    	<![endif]-->
    	<script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.7/es5-shim.min.js"></script>
    	<style>
    	/* FULL SCREEN FIXES */
    	.terminal a.ui-slider-handle:focus { outline: none; }
    	body { margin: 0; padding: 0; }
    	.clear { clear: both; }
    	html, body { height: 100%; }
    	@media screen and (-webkit-min-device-pixel-ratio:0) {
    	    .terminal, .terminal .terminal-output, .terminal .terminal-output div,
    	    .terminal .terminal-output div div, .cmd, .terminal .cmd span, .terminal .cmd div {
    	        font-weight: bold;
    	    }
    	}
    	</style>
<body>
        <div class="tv">
            <div id="term"></div>
            <div class="flicker"></div>
            <div class="scanlines"></div>
        </div>
<script>
jQuery(function($) {

    var anim = false;
    var scanlines = $('.scanlines');
    var tv = $('.tv');
    
    function set_size() {
        var height = $(window).height() * 0.2;
        var width = $(window).width() * 0.8;
        var time = (height * 2) / 170;
        scanlines[0].style.setProperty("--time", time);
        tv[0].style.setProperty("--width", width);
        tv[0].style.setProperty("--height", height);
    }
    
    function typed(finish_typing) {
        return function(term, message, delay, finish) {
            anim = true;
            var prompt = term.get_prompt();
            var c = 0;
            if (message.length > 0) {
                term.set_prompt('');
                var new_prompt = '';
                var interval = setInterval(function() {
                    var chr = $.terminal.substring(message, c, c+1);
                    new_prompt += chr;
                    term.set_prompt(new_prompt);
                    c++
                    if (c == length(message)) {
                        clearInterval(interval);
                        setTimeout(function() {
                            finish_typing(term, message, prompt);
                            anim = false
                            finish && finish();
                        }, delay);
                    }
                }, delay);
            }
        };
    }
    
    function length(string) {
        string = $.terminal.strip(string);
        return $('<span>' + string + '</span>').text().length;
    }
    
    var typed_prompt = typed(function(term, message, prompt){
        term.set_prompt(message + ' ');
    });
    var typed_message = typed(function(term, message, prompt){
        term.echo(message);
        term.set_prompt(prompt);
    });
    
    var valid_paths = [
        'Documents',
        'Documents/contact.txt',
        'Documents/resume.txt',
        'Documents/projects.txt'
    ];
    
    var term = $('#term').terminal({
        clear: function() {
            term.clear();
        },
        less: function(url) {
            try {
                if (!valid_paths.includes(url)){throw "invalid";}
                var ext = url.match(/\.([^.]+)$/)[1];
            } catch(e) {
                term.echo(url + ": No such file or directory")
                return; 
            }
            term.pause();
            $.get(url).then(file => {
                term.resume();
                term.less(file.split('\n'));
            });
        },
        ls: function(path='') {
            var files = '';
    
            path = path.trim();
    
            if (path.endsWith('/')){
                path = path.substring(0, path.length - 1);
            }
    
            if (path && !valid_paths.includes(path)){
                files = "ls: cannot access '" + path + "': No such file or directory";
            }
    
            valid_paths.forEach(val => {
                if (val.startsWith(path)){
                    var sub_path = val.substring(path ? path.length + 1 : 0, val.length);
    
                    if (sub_path.indexOf('/') == -1) {
                        files += sub_path + '\n';
                    }
                }
            });
    
            term.echo(files);
        },
        exit: function() {
            $('.tv').addClass('collapse');
            term.disable();
        }
    
    }, {
        name: 'exploit.design',
        prompt: '[[b;#cc6666;]root] [[b;#c5c8c6;]in] [[b;#8abeb7;]/home/dev] ',
        greetings: null,
        onResize: set_size,
        checkArity: false,
        completion: true,
        inputStyle: 'contenteditable',
        exceptionHandler: function(e, label) {
            if (typeof window.flush == 'undefined') {
              window.flush = 0;
            }
            if (flush++ <= 1){
                $('<pre>' + e.message + "\n" + e.stack + '</pre>').appendTo('body');
            }
        },
        onInit: function(term) {
            set_size();
            var msg = `Welcome to exploit.design
This site is a work in progress...
`;
    
            typed_message(term, msg, 50, function(){
                finish = true;
            });

            $('textarea').focus(function() {
                $(window).scrollTop(10);
                var keyboard_shown = $(window).scrollTop() > 0;
                $(window).scrollTop(0);
            }).focus();
        },
        keydown: function(e) {
            if (anim) {
                return false;
            }
        },
    }).css({
        overflow: 'auto'
    });
});
</script>
</body>
</html>
