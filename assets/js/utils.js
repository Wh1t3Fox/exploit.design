var scanlines = $(".scanlines");
var tv = $(".tv");
var anim = false;

var valid_paths = [
    "Documents",
    "Documents/contact.txt",
    "Documents/resume.txt",
    "Documents/projects.txt",
    "exploits",
    "exploits/README"
];

var devbox = new (function() {
    this.fs = {
        "": {
            "type": "d",
            "home": {
                "type": "d",
                "dev": {
                    "type": "d",
                    "Documents":{
                        "type": "d",
                        "contact.txt":{
                            "type": "f"
                        },
                        "resume.txt":{
                            "type": "f"
                        },
                        "projects.txt":{
                            "type": "f"
                        },
                        "type": "d"
                    },
                    "exploits":{
                        "type": "d",
                        "README": {
                            "type": "f"
                        }
                    },
                },
            },
        },
    };
    this.stack = ["", "home", "dev"];

    this.getCurrentPath = function(){
        return this.stack.join('/');
    },
    this.getCurrentWorkingDirectory = function(){
        var fs = this.fs;
        for(var f in this.stack){
            fs = fs[this.stack[f]];
        }
        return fs;
    };
})();

function set_size() {
    var height = $(window).height() * 0.2;
    var width = $(window).width() * 0.8;
    var time = (height * 2) / 170;
    scanlines[0].style.setProperty("--time", time);
    tv[0].style.setProperty("--width", width);
    tv[0].style.setProperty("--height", height);
}

function typed(finish_typing) {
    return function(term, message, delay, finish) {
        anim = true;
        var prompt = term.get_prompt();
        var c = 0;
        if (message.length > 0) {
            term.set_prompt("");
            var new_prompt = "";
            var interval = setInterval(function() {
                var chr = $.terminal.substring(message, c, c+1);
                new_prompt += chr;
                term.set_prompt(new_prompt);
                c++
                if (c == length(message)) {
                    clearInterval(interval);
                    setTimeout(function() {
                        finish_typing(term, message, prompt);
                        anim = false
                        finish && finish();
                    }, delay);
                }
            }, delay);
        }
    };
}

function length(string) {
    string = $.terminal.strip(string);
    return $("<span>" + string + "</span>").text().length;
}

var typed_prompt = typed(function(term, message, prompt){
    term.set_prompt(message + " ");
});
var typed_message = typed(function(term, message, prompt){
    term.echo(message);
    term.set_prompt(prompt);
});
    
